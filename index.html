<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Brilex - Scanner Prototype</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    .box { background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
    input { padding: 8px; width: 70%; }
    button { padding: 8px 12px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;}
    #scanner { width: 100%; height: 200px; border: 2px solid #007bff; display:none; margin-top: 10px;}
  </style>
</head>
<body>

<h2>📦 Brilex - Ajouter Produit avec Scanner</h2>

<div class="box">
  <label>Code-Barres:</label><br>
  <input type="text" id="barcodeInput" placeholder="Scannez ou entrez le code">
  <button onclick="startScanner('barcodeInput')">📷 Scanner</button>
  <div id="scanner"></div>

  <label>Nom Produit:</label><br>
  <input type="text" id="productName" placeholder="Nom du produit"><br>
  <label>Couleur:</label><br>
  <input type="text" id="productColor" placeholder="Couleur"><br>
  <label>Prix:</label><br>
  <input type="number" id="productPrice" placeholder="Prix"><br>
  <button onclick="addProduct()">Ajouter Produit</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
let products = JSON.parse(localStorage.getItem("products")) || [];

function addProduct() {
  let code = document.getElementById("barcodeInput").value.trim();
  let name = document.getElementById("productName").value.trim();
  let color = document.getElementById("productColor").value.trim();
  let price = parseFloat(document.getElementById("productPrice").value);
  if (!code || !name || !color || !price) { alert("⚠️ Remplissez tous les champs!"); return; }
  products.push({ code, name, color, price });
  localStorage.setItem("products", JSON.stringify(products));
  alert("✅ Produit ajouté avec succès!");
}

// 🎯 Fonction Scanner
function startScanner(inputId) {
  document.getElementById("scanner").style.display = "block";
  Quagga.init({
    inputStream: {
      name: "Live",
      type: "LiveStream",
      target: document.querySelector('#scanner'),
      constraints: { facingMode: "environment" }
    },
    decoder: { readers: ["ean_reader","code_128_reader","upc_reader","upc_e_reader"] }
  }, err => {
    if (err) { console.error(err); alert("Erreur caméra"); return; }
    Quagga.start();
  });

  Quagga.onDetected(data => {
    document.getElementById(inputId).value = data.codeResult.code;
    Quagga.stop();
    document.getElementById("scanner").style.display = "none";
    alert("✅ Code détecté: " + data.codeResult.code);
  });
}
</script>

</body>
</html>
